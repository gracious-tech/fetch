#!/bin/bash
# Build converters
set -e
cd "$(dirname "$(dirname "$0")")/converters"


# Do in each dir
# See `build_client` for docs on commands etc
for dir in */; do
    cd "$dir"

    rm -rf dist

    ../../node_modules/.bin/tsc --emitDeclarationOnly --outDir dist/esm
    esbuild="../../node_modules/.bin/esbuild --sourcemap --target=es6"
    $esbuild src/*.ts --format=esm --platform=neutral --outdir=dist/esm
    $esbuild src/index.ts --bundle --format=cjs  --platform=node --outfile=dist/bundled.cjs

    cd ..
done
